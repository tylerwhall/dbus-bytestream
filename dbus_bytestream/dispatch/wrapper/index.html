<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `wrapper` mod in crate `dbus_bytestream`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, wrapper">

    <title>dbus_bytestream::dispatch::wrapper - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../../main.css">

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <section class="sidebar">
        
        <p class='location'><a href='../../index.html'>dbus_bytestream</a>::<wbr><a href='../index.html'>dispatch</a></p><script>window.sidebarCurrent = {name: 'wrapper', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press 'S' to search, '?' for more options..."
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Module <a href='../../index.html'>dbus_bytestream</a>::<wbr><a href='../index.html'>dispatch</a>::<wbr><a class='mod' href=''>wrapper</a></span><span class='out-of-band'><span id='render-detail'>
            <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                [<span class='inner'>&#x2212;</span>]
            </a>
        </span><a id='src-7803' class='srclink' href='../../../src/dbus_bytestream/dispatch/wrapper.rs.html#1-279' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Macros to generate method call and signal handlers from Rust impl blocks.</p>

<p>These macros bind Rust functions to generic closures which can be used
with the message dispatcher.</p>

<p>For both signals and methods, the glue code validates the arguments in
the message body received from the bus and will return error responses
to the bus without invoking the callback.</p>

<p>Methods may optionally return a tuple of Encodables which will be
inserted in the body of the autogenerated method call response message.
The choice of a method to produce an autogenerated response is decided
at run time via an Option return. This allows method calls to
dynamically make the decision to defer the response message.</p>

<p>Method return arguments are guaranteed to be Encodable at compile time.
Since the methods have a signature known at compile time, this also
ensures a single method will always have the same return signature.</p>

<h1 id="examples" class='section-header'><a
                           href="#examples">Examples</a></h1><pre class='rust rust-example-rendered'>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>dbus_serialize</span>;
<span class='attribute'>#[<span class='ident'>macro_use</span>]</span>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>dbus_bytestream</span>;

<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>cell</span>::<span class='ident'>Cell</span>;

<span class='kw'>use</span> <span class='ident'>dbus_bytestream</span>::<span class='ident'>connection</span>::<span class='ident'>MessageSender</span>;
<span class='kw'>use</span> <span class='ident'>dbus_bytestream</span>::<span class='ident'>dispatch</span>::<span class='ident'>wrapper</span>::<span class='ident'>HandlerError</span>;
<span class='kw'>use</span> <span class='ident'>dbus_bytestream</span>::<span class='ident'>dispatch</span>::<span class='ident'>wrapper</span>::<span class='ident'>SignalReturn</span>;

<span class='attribute'>#[<span class='ident'>derive</span>(<span class='ident'>Default</span>)]</span>
<span class='kw'>struct</span> <span class='ident'>MySignalHandler</span> {
    <span class='ident'>val</span>: <span class='ident'>Cell</span><span class='op'>&lt;</span><span class='ident'>i32</span><span class='op'>&gt;</span>,
}

<span class='macro'>dbus_signal_impl</span><span class='macro'>!</span> {
    <span class='kw'>impl</span> <span class='ident'>MySignalHandler</span> {
        <span class='kw'>fn</span> <span class='ident'>TheSignalName</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>, <span class='ident'>_sender</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>MessageSender</span>, <span class='ident'>val</span>: <span class='ident'>i32</span>) <span class='op'>-&gt;</span> <span class='ident'>SignalReturn</span> {
            <span class='self'>self</span>.<span class='ident'>val</span>.<span class='ident'>set</span>(<span class='ident'>val</span>);
            <span class='prelude-val'>Ok</span>(())
        }
    }
}

<span class='kw'>fn</span> <span class='ident'>main</span>() {
    <span class='kw'>use</span> <span class='ident'>dbus_bytestream</span>::<span class='ident'>connection</span>::<span class='ident'>Connection</span>;
    <span class='kw'>use</span> <span class='ident'>dbus_bytestream</span>::<span class='ident'>dispatch</span>::{<span class='ident'>MessageDispatcher</span>, <span class='ident'>MessageHandler</span>};
    <span class='kw'>use</span> <span class='ident'>dbus_bytestream</span>::<span class='ident'>message</span>;

    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>conn</span> <span class='op'>=</span> <span class='ident'>Connection</span>::<span class='ident'>connect_system</span>().<span class='ident'>unwrap</span>();
    <span class='comment'>/* Create our signal handler object */</span>
    <span class='kw'>let</span> <span class='ident'>handler</span>: <span class='ident'>MySignalHandler</span> <span class='op'>=</span> <span class='ident'>Default</span>::<span class='ident'>default</span>();


    <span class='comment'>/* Register the signal handlers with a dispatcher */</span>
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>dis</span> <span class='op'>=</span> <span class='ident'>MessageDispatcher</span>::<span class='ident'>new</span>();
    <span class='kw'>for</span> (<span class='ident'>name</span>, <span class='ident'>handler</span>) <span class='kw'>in</span> <span class='ident'>handler</span>.<span class='ident'>get_signal_handlers</span>().<span class='ident'>into_iter</span>() {
        <span class='ident'>dis</span>.<span class='ident'>add_signal</span>(<span class='string'>&quot;path&quot;</span>.<span class='ident'>into</span>(), <span class='string'>&quot;interface&quot;</span>.<span class='ident'>into</span>(), <span class='ident'>name</span>.<span class='ident'>into</span>(), <span class='ident'>handler</span>);
    }

    <span class='kw'>let</span> <span class='ident'>sig</span> <span class='op'>=</span> <span class='ident'>message</span>::<span class='ident'>create_signal</span>(<span class='string'>&quot;path&quot;</span>, <span class='string'>&quot;interface&quot;</span>, <span class='string'>&quot;TheSignalName&quot;</span>)
                .<span class='ident'>add_arg</span>(<span class='kw-2'>&amp;</span><span class='number'>5</span>);

    <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>handler</span>.<span class='ident'>val</span>.<span class='ident'>get</span>(), <span class='number'>0</span>);
    <span class='ident'>dis</span>.<span class='ident'>handle_message</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>conn</span>, <span class='ident'>sig</span>);
    <span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='ident'>handler</span>.<span class='ident'>val</span>.<span class='ident'>get</span>(), <span class='number'>5</span>);
}
</pre>
</div><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table>
                    <tr class=' module-item'>
                        <td><a class='type' href='type.HandlerError.html'
                               title='dbus_bytestream::dispatch::wrapper::HandlerError'>HandlerError</a></td>
                        <td class='docblock short'>
                             
                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='type' href='type.MethodReturn.html'
                               title='dbus_bytestream::dispatch::wrapper::MethodReturn'>MethodReturn</a></td>
                        <td class='docblock short'>
                             <p>Return value for method handler functions</p>

                        </td>
                    </tr>
                
                    <tr class=' module-item'>
                        <td><a class='type' href='type.SignalReturn.html'
                               title='dbus_bytestream::dispatch::wrapper::SignalReturn'>SignalReturn</a></td>
                        <td class='docblock short'>
                             <p>Return value for signal handler functions</p>

                        </td>
                    </tr>
                </table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&larrb;</dt>
                <dd>Move up in search results</dd>
                <dt>&rarrb;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code>, <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
            <p>
                Search functions by type signature (e.g.
                <code>vec -> usize</code>)
            </p>
        </div>
    </div>

    

    <script>
        window.rootPath = "../../../";
        window.currentCrate = "dbus_bytestream";
        window.playgroundUrl = "";
    </script>
    <script src="../../../jquery.js"></script>
    <script src="../../../main.js"></script>
    
    <script async src="../../../search-index.js"></script>
</body>
</html>